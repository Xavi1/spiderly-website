<app-section-wrapper parts="one" text-align="left" >

  <form style="width: 100%;">
    @for (entityFormGroup of getFormArrayGroups(entitiesFormArray); track $index; let entityIndex = $index) {
      <index-card 
      [index]="entityIndex" 
      [last]="false" 
      [crudMenu]="entitiesCrudMenu" 
      (onMenuIconClick)="lastEntitiesMenuIconIndexClicked.index = $event"
      (onCrudMenuItemRemove)="onEntitiesItemRemove($event)"
      >
      <div class="playground-code-block-wrapper">
        
        <div class="c-sharp-class-form">
          
          <div style="margin-bottom: 18px;">
            <spiderly-textbox [control]="entityFormGroup.controls.name"></spiderly-textbox>
          </div>
          
          @for (attributeFormGroup of getEntityAttributesFormArrayGroups(entityFormGroup); track $index; let entityAttributeIndex = $index) {
              <index-card 
              [index]="entityAttributeIndex" 
              [last]="false"
              [crudMenu]="getEntityAttributesCrudMenu(entityFormGroup)"
              (onMenuIconClick)="lastEntityAttributesMenuIconIndexClicked.index = $event"
              >
                <spiderly-dropdown [control]="attributeFormGroup.controls.name" [options]="entityAttributeOptions"></spiderly-dropdown>
              </index-card>
            }
            <p-button (onClick)="addNewEntityAttribute(entityFormGroup)" [style]="{'margin-bottom': '18px'}" size="small" label="Add new attribute" icon="pi pi-plus"></p-button>

            <div>
              @for (propertyFormGroup of getPropertiesFormArrayGroups(entityFormGroup); track $index; let propertyIndex = $index) {
                <index-card 
                [index]="propertyIndex" 
                [last]="false"
                [crudMenu]="getPropertiesCrudMenu(entityFormGroup)"
                (onMenuIconClick)="lastPropertiesMenuIconIndexClicked.index = $event"
                >
                  <div style="margin-bottom: 18px;">
                    <spiderly-dropdown [control]="propertyFormGroup.controls.dataType" [options]="cSharpDataTypeOptions"></spiderly-dropdown> 
                  </div>
                  <div style="margin-bottom: 18px;">
                    <spiderly-textbox [control]="propertyFormGroup.controls.name"></spiderly-textbox>
                  </div>
                  <div>
                    @for (attributeFormGroup of getPropertyAttributesFormArrayGroups(propertyFormGroup); track $index; let propertyAttributeIndex = $index) {
                      <index-card 
                      [index]="propertyAttributeIndex" 
                      [last]="false"
                      [crudMenu]="getPropertyAttributesCrudMenu(propertyFormGroup)"
                      (onMenuIconClick)="lastPropertyAttributesMenuIconIndexClicked.index = $event"
                      >
                        <spiderly-dropdown [control]="attributeFormGroup.controls.name" [options]="entityAttributeOptions"></spiderly-dropdown>
                      </index-card>
                    }
                    <p-button (onClick)="addNewPropertyAttribute(propertyFormGroup)" size="small" label="Add new attribute" icon="pi pi-plus"></p-button>
                  </div>
                </index-card>
              }
              <p-button (onClick)="addNewProperty(entityFormGroup)" [style]="{'margin-bottom': '18px'}" size="small" label="Add new property" icon="pi pi-plus"></p-button>
            </div>

            <p-button (onClick)="saveEntityFormGroup(entityFormGroup)" size="small" label="Save" icon="pi pi-save"></p-button>
          </div>

          <code class="code-editor">
            @for (attributeFormGroup of getEntityAttributesFormArrayGroups(entityFormGroup); track $index; let entityAttributeIndex = $index) {
              <div>
                [<span class="punct">{{attributeFormGroup.controls.name.value}}</span>
                <ng-container *ngIf="attributeFormGroup.controls.value.value != null">(<span>{{attributeFormGroup.controls.value.value}}</span>)</ng-container>]
              </div>
            }
  
            <div>
              <span class="kw">public class</span> <span class="punct"> {{entityFormGroup.controls.name.value}}</span> {{ocb}}
            </div>
  
            <div style="margin-bottom: 35px;"></div>
  
            <div style="margin-left: 20px;">
              @for (propertyFormGroup of getPropertiesFormArrayGroups(entityFormGroup); track $index; let propertyIndex = $index) {
                @for (attributeFormGroup of getPropertyAttributesFormArrayGroups(propertyFormGroup); track $index; let propertyAttributeIndex = $index) {
                  <div>
                    [<span class="punct">{{attributeFormGroup.controls.name.value}}</span>
                    <ng-container *ngIf="attributeFormGroup.controls.value.value != null">(<span>{{attributeFormGroup.controls.value.value}}</span>)</ng-container>]
                  </div>
                }
  
                <div>
                  <span class="kw">public {{propertyFormGroup.controls.dataType.value}}</span> {{propertyFormGroup.controls.name.value}} {{ocb}} <span class="kw">get</span>; <span class="kw">set</span>; {{ccb}} 
                </div>
  
                <div style="margin-bottom: 35px;"></div>
              }
            </div>
  
            <div style="margin-bottom: 15px;">
              {{ccb}}
            </div>
          </code>

        </div>
      </index-card>
    }
    <p-button (onClick)="addNewEntity()" label="Add new class" icon="pi pi-plus"></p-button>
  </form>

  <div class="web-page">
    <app-layout [menu]="menu" [entities]="entities"></app-layout>
  </div>

</app-section-wrapper>